$(document).ready(function(){

  // setInterval(function(){
  //   $.get('/requests/current.json').success(function(data){
  //     $('#daily_production').data("daily-data", data);
  //     console.log('retrieving new data...')
  //   });
  // }, 200000);
  

  var daily_data = $('#daily_production').data("daily-data").split(" ");
  for(var i=0; i<daily_data.length; i++) { daily_data[i] = parseInt(daily_data[i], 10); };    
  var daily_time = $('#daily_production').data("daily-time");

  var daily_production = new Highcharts.Chart({
    chart: {
      height: '200',
      borderRadius: 0,
      renderTo: "daily_production",
      type: 'areaspline',
      backgroundColor: gon.chart_background,
      plotBackgroundColor: null,
      animation: {
        easing: "linear",
        duration: 3000
      },
      events: {
        load: function() {
          setInterval(function(){
            $.get('/requests/current.json').success(function(response){
              if (jQuery.type($('#daily_production').data("daily-data")) == "string"){
                if (response.length > $('#daily_production').data("daily-data").split(" ").length) {
                $('#daily_production').data("daily-data", response);
                daily_production.series[0].setData($('#daily_production').data("daily-data"));
                console.log('chart redrawn');
                }else{
                  console.log('no new data, array length: ' + $('#daily_production').data("daily-data").split(" ")length);
                }
              }else{
                if (response.length > $('#daily_production').data("daily-data").length) {
                  $('#daily_production').data("daily-data", response);
                  daily_production.series[0].setData($('#daily_production').data("daily-data"));
                  console.log('chart redrawn');
                } else {
                  console.log('no new data, array length: ' + $('#daily_production').data("daily-data").length);
                }
              }
            })
          }, 2000);
        }
      },
      title: {
        text: "Energy Produced today, by the Hour",
        style: {
          color: '#cc0000',
          fontWeight: 'bold',
          fontSize: '25px',
          fontFamily: '\'orbitron-light\', sans-serif'
        }
      },
      legend: {
        enabled: false
      }
    },        
    xAxis: {
      type: "datetime",
      tickColor: '#dac092',
      labels: {
        style: {
          color: '#cc0000'
        }
      }
    },
    yAxis: {
      title: {
        text: "Watt-Hours", 
        style: {
          color: '#cc0000'
        }
      },
            labels: {
        style: {
          color: '#cc0000'
        }
      }
    },
    plotOptions: {
      series: {
        fillColor: {
          linearGradient: [0,0,0,300],
          stops: [
            [0, '#00FF64'],
            [1, 'rgba(0, 20, 10, 0.7)']
          ]
        },
        shadow: true,
        offsetX: "3px",
        offsetY:"3px",
        opacity:"0.6",
        lineColor: '#00FF64',
        marker: {
          enabled: false,
        }
      }
    },
    series: [
      { 
        name: "Today's Production",
        pointInterval: 300000,
        pointStart: daily_time,
        data: daily_data,
        animation: {
          easing: "linear",
          duration: "3000"
        }
      } 
    ]       
  });
}); 

